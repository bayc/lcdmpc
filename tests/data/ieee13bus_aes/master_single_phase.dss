Clear

!
! This script is based on a script developed by Tennessee Tech Univ students
! Tyler Patton, Jon Wood, and David Woods, April 2009
!

new circuit.IEEE13Nodeckt
~ basekv=115 pu=1.0001 phases=1 bus1=SourceBus
~ Angle=30                                                         ! advance angle 30 deg so result agree with published angle
~ MVAsc3=20000 MVASC1=21000                                        ! stiffen the source to approximate inf source



!SUB TRANSFORMER DEFINITION
! Although this data was given, it does not appear to be used in the test case results
! The published test case starts at 1.0 per unit at Bus 650. To make this happen, we will change the impedance
! on the transformer to something tiny by dividing by 1000 using the DSS in-line RPN math
New Transformer.Sub Phases=3 Windings=2   XHL=(8 1000 /)
~ wdg=1 bus=SourceBus   conn=delta  kv=115  kva=5000   %r=(.5 1000 /)  XHT=4
~ wdg=2 bus=650             conn=wye    kv=4.16  kva=5000   %r=(.5 1000 /)   XLT=4

! FEEDER 1-PHASE VOLTAGE REGULATORS
! Define low-impedance 2-wdg transformer

New Transformer.Reg1 phases=1 XHL=0.01 kVAs=[1666 1666]
~ Buses=[650.1 RG60.1] kVs=[2.4  2.4] %LoadLoss=0.01
new regcontrol.Reg1  transformer=Reg1 winding=2  vreg=122  band=2  ptratio=20 ctprim=700  R=3   X=9

New Transformer.Reg2 phases=1 XHL=0.01 kVAs=[1666 1666]
~ Buses=[650.2 RG60.2] kVs=[2.4  2.4] %LoadLoss=0.01
new regcontrol.Reg2  transformer=Reg2 winding=2  vreg=122  band=2  ptratio=20 ctprim=700  R=3   X=9

New Transformer.Reg3 phases=1 XHL=0.01 kVAs=[1666 1666]
~ Buses=[650.3 RG60.3] kVs=[2.4  2.4] %LoadLoss=0.01
new regcontrol.Reg3  transformer=Reg3 winding=2  vreg=122  band=2  ptratio=20 ctprim=700  R=3   X=9


!TRANSFORMER DEFINITION
! New Transformer.XFM1  Phases=3   Windings=2  XHL=2
! ~ wdg=1 bus=633       conn=Wye kv=4.16    kva=500    %r=.55     XHT=1
! ~ wdg=2 bus=634       conn=Wye kv=0.480    kva=500    %r=.55   XLT=1

!LINE CODES ++ MS: All change to single phase (why are there no shunts??)
redirect IEEELineCodes.dss

// these are local matrix line codes
// corrected 9-14-2011
New linecode.mtx601 nphases=1 BaseFreq=60
~ rmatrix = (0.3465)
~ xmatrix = (1.0179)
~ units=mi
New linecode.mtx602 nphases=1 BaseFreq=60
~ rmatrix = (0.7526)
~ xmatrix = (1.1814)
~ units=mi
New linecode.mtx603 nphases=1 BaseFreq=60
~ rmatrix = (1.3238)
~ xmatrix = (1.3569)
~ units=mi
New linecode.mtx604 nphases=1 BaseFreq=60
~ rmatrix = (1.3238)
~ xmatrix = (1.3569)
~ units=mi
New linecode.mtx605 nphases=1 BaseFreq=60
~ rmatrix = (1.3292)
~ xmatrix = (1.3475)
~ units=mi

New linecode.mtx606 nphases=1  Units=mi
~ Rmatrix=[0.791721]
~ Xmatrix=[0.438352]
~ Cmatrix=[383.948]
New linecode.mtx607 nphases=1 BaseFreq=60
~ rmatrix = (1.3425)
~ xmatrix = (0.5124)
~ cmatrix = [236]
~ units=mi


!LOAD DEFINITIONS ++ MS: All change to single phase
New Load.671 Bus1=671  Phases=1 Conn=Wye  Model=1 kV=4.16   kW=0     kvar=0
New Load.634 Bus1=634  Phases=1 Conn=Wye  Model=1 kV=0.277  kW=0     kvar=0
New Load.645 Bus1=645  Phases=1 Conn=Wye  Model=1 kV=2.4    kW=300   kvar=0
New Load.646 Bus1=646  Phases=1 Conn=Wye  Model=1 kV=4.16   kW=300   kvar=0
New Load.652 Bus1=652  Phases=1 Conn=Wye  Model=1 kV=2.4    kW=300   kvar=0
New Load.692 Bus1=692  Phases=1 Conn=Wye  Model=5 kV=4.16   kW=0     kvar=0
New Load.675 Bus1=675  Phases=1 Conn=Wye  Model=1 kV=2.4    kW=0     kvar=0
New Load.611 Bus1=611  Phases=1 Conn=Wye  Model=5 kV=2.4    kW=0     kvar=0

!Generator DEFINITIONS ++ MS: All change to single phase LOADS
New Load.645 Bus1=645  Phases=1 Conn=Wye  Model=1 kV= 2.4   kW=300   kvar=0
New Load.646 Bus1=646  Phases=1 kV= 2.4 kW=300 Model=1 kvar=0
New Load.652 Bus1=652  Phases=1 kV= 2.4 kW=300 Model=1 kvar=0


!CAPACITOR DEFINITIONS ++ MS: 675 changed to single phase LOAD, 611 capacitor removed
New Load.675 Bus1=675 phases=1 kVAR=600 kV=4.16

!LINE DEFINITIONS ++ MS: All change to single phase
New Line.650632    Phases=1 Bus1=RG60   Bus2=632  LineCode=mtx601 Length=2000 units=ft
New Line.632671    Phases=1 Bus1=632    Bus2=670  LineCode=mtx601 Length=2000 units=ft
New Line.671680    Phases=1 Bus1=671    Bus2=680  LineCode=mtx601 Length=1000 units=ft
New Line.632633    Phases=1 Bus1=632    Bus2=633  LineCode=mtx602 Length=500  units=ft
New Line.632645    Phases=1 Bus1=632    Bus2=645  LineCode=mtx603 Length=500  units=ft
New Line.645646    Phases=1 Bus1=645    Bus2=646  LineCode=mtx603 Length=300  units=ft
New Line.692675    Phases=1 Bus1=692    Bus2=675  LineCode=mtx606 Length=500  units=ft
New Line.671684    Phases=2 Bus1=671    Bus2=684  LineCode=mtx604 Length=300  units=ft
New Line.684611    Phases=1 Bus1=684    Bus2=611  LineCode=mtx605 Length=300  units=ft
New Line.684652    Phases=1 Bus1=684    Bus2=652  LineCode=mtx607 Length=800  units=ft


!SWITCH DEFINITIONS ++ MS: All change to single phase line w/o switch
New Line.671692    Phases=1 Bus1=671    Bus2=692  

! ++ MS: Replace transformer with line
New Line.633634    Phases=1 Bus1=633    Bus2=634 LineCode=mtx602 Length=500 units=ft

New EnergyMeter.Main Transformer.sub

Set Voltagebases=[115, 4.16, .48]
calcv
Solve
BusCoords buscoord.dss

!---------------------------------------------------------------------------------------------------------------------------------------------------
!----------------Show some Results -----------------------------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------------------------------------------------------------
// Show Voltages LN Nodes
// Show Currents Elem
// Show Powers kVA Elem
// Show Losses
// Show Taps
Export Y
!---------------------------------------------------------------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------------------------------------------------------------
! Alternate Solution Script
! To force the taps to be same as published results, set the transformer taps manually and disable the controls
!---------------------------------------------------------------------------------------------------------------------------------------------------
/*
Transformer.Reg1.Taps=[1.0 1.0625]
Transformer.Reg2.Taps=[1.0 1.0500]
Transformer.Reg3.Taps=[1.0 1.06875]
Set Controlmode=OFF

Solve
*/